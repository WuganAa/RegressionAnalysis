---
title: "Winter7 冬第7周上机内容"
author: "ChenXG 陈栩淦 3160104014"
date: "12/18/2018"
output: html_document
---


```{r}
Sys.setlocale("LC_ALL", locale = "en_US.UTF-8")
setwd("~/Project/RegressionAnalysis")
```

```{r}
library(car)
```

## 题1

某经济学家想调查文化程度对家庭储蓄的影响。在一个中等收入的样本框中，随机调查了13户高学历家庭和14户中低收入家庭。因变量$y$表示上一年家庭储蓄增加额，自变量$x_1$为上一年度家庭总收入，自变量$x_2$表示家庭学历，其中$x_2 = 1$表示高学历家庭，而$x_2 = 0$表示低学历家庭，其调查数据如下表所示。请分析学历对家庭储蓄增加额有无显著影响。

```{r}
y <- c(235, 346, 365, 468, 658, 867, 1085, 1236, 1238, 1345, 2365, 2365, 3256, 3256,
       3265, 3265, 3567, 3658, 4588, 6436, 9047, 7985, 8950, 9685, 9866, 10235, 10140)
x1 <- c(2.3, 3.2, 2.8, 3.5, 2.6, 3.2, 2.6, 3.4, 2.2, 2.8, 2.3, 3.7, 4.0, 2.9,
        3.8, 4.6, 4.2, 3.7, 3.5, 4.8, 5.0, 4.2, 3.9, 4.8, 4.6, 4.8, 4.2)
x2 <- c(0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0,
        1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0)

data <- data.frame(y, x1, x2)
```

### 分学历建立回归方程

首先我们根据学历进行分类，分别建立回归方程，看看不同学历间方程是否不同。

```{r}
lm.reg1 <- lm(y~x1, data = data, subset = which(data['x2'] == 1))
summary(lm.reg1)

lm.reg0 <- lm(y~x1, data = data, subset = which(data['x2'] == 0))
summary(lm.reg0)
```

学历分类求得的回归方程分别是：
$$
\text{高学历家庭：} \hat{y} = 3269.6 \times x_1 - 9540.9, \\
\text{低学历家庭：} \hat{y} = 4037.3 \times x_1 - 8709.3.
$$

可以看到，$x_1$的系数和常数项差异均较大。不同学历家庭的上一年的家庭总收入对储蓄增加额是不同的。

### 统一处理数据

建立回归方程：
$$
y_i = \beta_0 + beta_1 \times x_{i1} + \delta \times x_{i2} + e_i,\ i = 1, \dots, 27, e_i\sim N(0, \sigma^2),\ i.i.d. 
$$


```{r}
lm.sol <- lm(y~x1+x2, data = data)
summary(lm.sol)
deviance(lm.sol)
```

根据虚拟变量建立的回归方程为：
$$
\hat{y} = 3812.1 \times x_1 - 3681.4 \times x_2 - 7941.9.
$$

不同学历家庭的回归方程是：
$$
\text{高学历家庭：} \hat{y} = \hat{\beta_0} + \hat{\beta_1} \times x_1 + \hat{\delta} = - 11623.3 + 3812.1 \times x_1, \\
\text{低学历家庭：} \hat{y} = \hat{\beta_0} + \hat{\beta_1} \times x_1 = - 7941.9 + 3812.1 \times x_1.
$$

残差平方和和自由度分别为
$$
RSS = 40071713,\quad n - 2 - 1 = 24.
$$


为了检验学历4.259677，这相当于检验假设
$$
H: \delta = 0,
$$

等价于关于未知参数向量$\beta = (\beta_0, \beta_1, \delta)^{'}$的线性假设：
$$
H: A\beta = b,
$$

其中
$$
A = (0, 0, 1),\quad b = 0.
$$

在上述假设为真时，约简模型为
$$
y_i = \beta_0 + beta_1 \times x_{i1} + e_i,\ i = 1, \dots, 27, e_i\sim N(0, \sigma^2),\ i.i.d. 
$$
```{r}
lm.sol2 <- lm(y~x1, data = data)
summary(lm.sol2)
deviance(lm.sol2)
```

约简模型的回归方程为：
$$
\hat{y} = 3253.3 \times x_1 - 7694.5,
$$
相应的残差平方和和自由度分别为

$$
RSS_H = 125447426,\quad n - 1 - 1 = 25.
$$

在上述假设为真时，
$$
F = \frac{(RSS_H - RSS)/ 1}{RSS / (27 - 2 - 1)} \sim F(1, 24),
$$
计算可得，
$$
F = \frac{(125447426 - 40071713) / 1}{40071713 / 24} = 51.13375 > F_0.05(1, 24) = 4.259677.
$$

因此拒绝原假设，这表明学历对家庭储蓄增加额有显著影响。

### 使用$linearHypothesis$进行假设检验

```{r}
lm.sol <- lm(y~x1+x2, data = data)
A <- matrix(c(0, 0, 1), nrow = 1, byrow = T)
b <- c(0)
linearHypothesis(lm.sol, hypothesis.matrix = A, rhs = b, test = "F")
```

可以看到，$F = 51.134$，p值为 $2.167\times 10^{-7} < 0.05$，则拒绝原假设，这表明学历对家庭储蓄增加额有显著影响。



## 题2

在一次关于公共交通的社会调查中，一个调查项目是“乘坐公共汽车上下班还是骑自行车上下班”。因变量$y = 1$表示主要乘公共汽车上下班，$y = 0$表示主要骑自行车上下班。自变量$x_1$是年龄，$x_2$是月收入，$x_3$是性别（1表示男性，2表示女性）。调查对象为工薪族群体，数据见下表。请建立Logistic回归模型。

```{r}
y <- c(0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 
       0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1)
x1 <- c(18, 21, 23, 23, 28, 31, 36, 42, 46, 48, 55, 56, 58, 18,
        20, 25, 27, 28, 30, 32, 33, 33, 38, 41, 45, 48, 52, 56)
x2 <- c(850, 1200, 950, 950, 1200, 850, 1500, 1000, 950, 1200, 1800, 2100, 1800, 850,
        1000, 1200, 1300, 1500, 950, 1000, 1800, 1000, 1200, 1500, 1800, 1000, 1500, 1800)
x3 <- c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)

data <- data.frame(y, x1, x2, x3)
```



```{r}
glm.sol <- glm(y~x1+x2+x3, family = binomial(link = "logit"), data = data)
summary(glm.sol)
```

得到的Logistic回归方程为
$$
\hat{y}^* = log{\frac{\hat{\pi}}{1 - \hat{\pi}}} = - 3.860323 + 0.080394 \times x_1 + 0.001743 \times x_2 -2.543947\times x_3,
$$
即
$$
\hat{\pi} = \frac{\exp{(- 3.860323 + 0.080394 \times x_1 + 0.001743 \times x_2 -2.543947\times x_3)}}{1 + \exp{(- 3.860323 + 0.080394 \times x_1 + 0.001743 \times x_2 -2.543947\times x_3)}}.
$$

由于参数$\beta_1$和$\beta_2$没有通过$95\%$的显著性检验，我们采用$step()$做变量筛选。

```{r}
glm.reg <- glm(y~1, family = binomial(link = "logit"), data = data)
step.model <- step(glm.reg, direction = "both", scope = (~x1+x2+x3))
summary(step.model)
```


得到的新的Logistic回归方程：
$$
\hat{y}^* = log{\frac{\hat{\pi}}{1 - \hat{\pi}}} = - 2.6285 + 0.1023 \times x_1 -2.2239\times x_3,
$$
即
$$
\hat{\pi} = \frac{\exp{(- 2.6285 + 0.1023 \times x_1 -2.2239\times x_3)}}{1 + \exp{(- 2.6285 + 0.1023 \times x_1 -2.2239\times x_3)}}.
$$









